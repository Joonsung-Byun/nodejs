<!DOCTYPE html>
<html lang="en">

<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>Recommendation</title>
   <link href="/output.css" rel="stylesheet">
   <link rel="preconnect" href="https://fonts.googleapis.com">
   <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
   <link href="https://fonts.googleapis.com/css2?family=Noto+Sans:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">

   <style>
      #answer {
  font-family: 'Inter', 'Noto Sans KR', sans-serif;
  background-color: #f9fafb;
  border-radius: 12px;
  padding: 24px;
  line-height: 1.75;
  color: #1f2937;
}

/* 헤더 스타일 */
#answer h1 {
  font-size: 1.5rem;
  font-weight: 700;
  margin-top: 1.5em;
  margin-bottom: 0.6em;
  border-bottom: 2px solid #e5e7eb;
  padding-bottom: 0.3em;
  color: #111827;
}

#answer h2 {
  font-size: 1.2rem;
  font-weight: 600;
  margin-top: 1em;
  margin-bottom: 0.4em;
  color: #1f2937;
}

/* 문단 */
#answer p {
  margin-top: 0.4em;
  margin-bottom: 0.4em;
}

/* 리스트 (있을 경우) */
#answer ul,
#answer ol {
  margin-left: 1.5em;
  margin-top: 0.5em;
  margin-bottom: 0.5em;
}

/* 강조 */
#answer strong {
  font-weight: 600;
  color: #111827;
}

/* 코드나 특수 텍스트 있을 경우 대비 */
#answer code {
  background-color: #e5e7eb;
  padding: 0.2em 0.4em;
  border-radius: 4px;
  font-family: 'Fira Code', monospace;
  font-size: 0.95em;
}

/* 구분선 */
#answer hr {
  border: none;
  border-top: 1px solid #e5e7eb;
  margin: 1.5em 0;
}
   </style>
</head>

<body class="bg-white pb-4 recommendation">

   <%- include('nav.ejs') %>

   <!--popup modal-->
   <% if (!isAuthenticated) { %>
      
   <div id="modal" class="fixed inset-0 bg-gray-900 bg-opacity-50 z-50">
      <div class="modal-content bg-white text-center w-72 md:w-96 md:text-left  mx-auto my-40 p-4 rounded-lg">
         <h2 class="text-lg ">Save your trip plans by logging in and revisit them anytime you need.</h2>
         <div class="flex justify-end gap-4 mt-4">
            <a id="cancelBtn" href="/login" class="p-2 bg-blue-500 text-white rounded">Login</a>
            <button id="deleteBtn" class="p-2 bg-gray-200 text-black rounded">Try as Guest</button>
         </div>
      </div>
   </div>
   <% } %>

      <div id="listWrapper" class="gap-4 mt-20 md:mt-16 mx-auto <%= isAuthenticated ? 'lg:flex' : 'max-w-5xl' %>">

         <% if(isAuthenticated) { %>
            <div>
               <button class="historyBtn ml-2 mt-2 z-40 absolute drop-shadow-sm  rounded-lg p-2 gap-2 flex flex-col lg:hidden overflow-hidden">
                  <span class="line1 h-1 w-9 bg-gray-500 rounded-md"></span>
                  <span class="line2 h-1 w-9 bg-gray-500 rounded-md"></span>
                  <span class="line3 h-1 w-9 bg-gray-500 rounded-md"></span>
                </button>
               <aside id="default-sidebar"
                  class=" w-64 h-screen lg:min-h-full absolute lg:relative transition-transform -translate-x-full lg:translate-x-0">
                  <div class="h-full px-3 py-4 overflow-y-auto bg-gray-100 text-black ">
                     <ul class="space-y-2 font-medium mt-10 lg:mt-0 list-none">
                        <% if (!isAuthenticated) { %>
                           <li>
                              <a href="/login"
                                 class="flex items-center p-2 text-gray-900 rounded-lg dark:text-white hover:bg-gray-100 dark:hover:bg-gray-700 group">
                                 <svg
                                    class="flex-shrink-0 w-5 h-5 text-gray-500 transition duration-75 dark:text-gray-400 group-hover:text-gray-900 dark:group-hover:text-white"
                                    aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 18 16">
                                    <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"
                                       stroke-width="2"
                                       d="M1 8h11m0 0L8 4m4 4-4 4m4-11h3a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2h-3" />
                                 </svg>
                                 <span class="flex-1 ms-3 whitespace-nowrap"></span>
                              </a>
                           </li>
                           <% } else {%>
                              <% if(history.length !== 0) {%>
                                 <% history.forEach((item)=> { %>
                                    <li class="eachList hover:bg-gray-200 p-2 rounded-md">
                                       <a class="block" href=<%- `/recommendation/detail/${item.id}` %>> <%- item.location %>, <%- item.days %> 
                                          <%- item.days == 1 ? 'day' : 'days' %>
                                       </a>
                                    </li>
                                    <% }) %>
                                    <% } else { %>
                                       <li class="eachList  p-2 rounded-md">
                                          <a>Your trip plans will be saved here!</a>
                                       </li>

                                       <% } %>
                                       <% } %>
                     </ul>
                  </div>
               </aside>
            </div>
            <%} else {%>
            <div>

            </div>
            <%} %>




         <section class="<%= isAuthenticated ? 'pl-20 pt-12 pr-4' : 'p-4' %>  lg:basis-8/12 homeWrapper">
            <h1 class="text-lg md:text-xl leading-5 font-semibold">AI Trip Planner</h1>
            <h1 class="text-lg md:text-xl leading-8"> Please fill out the form below to get started. </h1>


            <div id="recommendForm" class="flex flex-col gap-4 mt-8 pr-4">
               <div class="flex flex-col gap-2">
                  <label for="days">How many days are you going to travel? *</label>
                  <input required type="number" id="days" min="1" max="10" class="p-2 border border-gray-300 rounded"
                     placeholder="Enter the number of days, min 1 day, max 10 days">


               </div>

               <div class="flex flex-col gap-2">
                  <label for="location">Where are you going to travel? *</label>
                  <input required type="text" id="location" class="p-2 border border-gray-300 rounded"
                     placeholder="Enter the location">
               </div>

               <div class="flex flex-col gap-2">
                  <label for="type">What kind of trip do you want? *</label>
                  <select required id="type" class="p-2 border border-gray-300 rounded">
                     <option value="relax">Relax</option>
                     <option value="adventure">Adventure</option>
                     <option value="culture">Culture</option>
                     <option value="shopping">Shopping</option>
                     <option value="history">History</option>
                     <option value="nature">Nature</option>
                     <option value="sport">Sport</option>
                  </select>
               </div>

               <div class="flex flex-col gap-2">
                  <label for="budget">What is your budget? *</label>
                  <select required id="budget" class="p-2 border border-gray-300 rounded">
                     <option value="low">Low</option>
                     <option value="medium">Medium</option>
                     <option value="high">High</option>
                  </select>

                  <button id="submitBtn" class="p-2 bg-blue-500 text-white rounded">Recommend</button>
               </div>

               <div id="recommendResult" class=" mt-4">
                  <h2 class="text-2xl font-bold">Recommended Trip Plan</h2>
                  <div id="recommendList" class="flex flex-col gap-4 mt-4">
                     <div class="flex flex-col gap-2 border rounded-lg">
                        <div id="answer" class="bg-gray-50 rounded-lg min-h-[100px]"></div>
                     </div>
                  </div>
               </div>
            </div>
         </section>
      </div>

      <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
      <script type="module" src="/recommend.js"></script>

</body>

</html>